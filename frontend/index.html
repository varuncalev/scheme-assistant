<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SchemeSahayak â€” Official Government AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg-side: #0f172a; 
            --bg-main: radial-gradient(at 0% 0%, rgba(255, 153, 51, 0.15) 0px, transparent 50%), 
                       radial-gradient(at 100% 100%, rgba(19, 136, 8, 0.15) 0px, transparent 50%),
                       #ffffff;
            --primary: #4f46e5; 
            --slate-200: #e2e8f0;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-800: #1e293b;
            --saffron: #FF9933;
            --navy: #000080;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-main); height: 100vh; overflow: hidden; color: var(--slate-800); }

        .shell { display: flex; height: 100vh; width: 100%; position: relative; }

        /* â”€â”€ SIDEBAR FIX â”€â”€ */
        .sidebar {
            width: 280px; background: var(--bg-side); color: white;
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            z-index: 1000; flex-shrink: 0;
        }
        
        @media (max-width: 768px) { 
            .sidebar { position: fixed; left: 0; height: 100%; transform: translateX(-100%); } 
            .sidebar.active { transform: translateX(0); } 
        }

        .sidebar-toggle {
            position: absolute; left: 16px; top: 16px; 
            width: 42px; height: 42px; background: white; border: 1.5px solid var(--slate-200);
            border-radius: 10px; cursor: pointer; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; gap: 4px; z-index: 1001; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .bar { width: 18px; height: 2px; background: var(--bg-side); border-radius: 2px; }

        .brand { padding: 24px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        @media (max-width: 768px) { .brand { padding-left: 64px; } }

        .btn-new-chat {
            margin: 16px; padding: 12px; border-radius: 10px; background: rgba(255, 153, 51, 0.15); 
            color: var(--saffron); border: 1px solid rgba(255, 153, 51, 0.4); text-align: center; 
            cursor: pointer; font-weight: 700; font-size: 14px;
        }

        /* â”€â”€ HISTORY STYLES â”€â”€ */
        .history-item {
            padding: 10px 12px; margin-bottom: 5px; border-radius: 8px; font-size: 13px;
            color: var(--slate-400); cursor: pointer; white-space: nowrap; overflow: hidden;
            text-overflow: ellipsis; transition: 0.2s;
        }
        .history-item:hover { background: rgba(255,255,255,0.1); color: white; }

        /* â”€â”€ TOP BAR & EXPORT â”€â”€ */
        .top-bar { 
            height: 74px; display: flex; align-items: center; justify-content: flex-end; 
            padding: 0 24px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--slate-200); position: sticky; top: 0; z-index: 900;
        }
        .btn-export {
            background: transparent; border: 2px solid var(--navy); color: var(--navy); 
            padding: 8px 18px; border-radius: 8px; font-size: 13px; font-weight: 700; cursor: pointer;
        }

        .main { flex: 1; display: flex; flex-direction: column; min-width: 0; position: relative; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px 20px 140px; scroll-behavior: smooth; }
        .center-wrap { max-width: 800px; margin: 0 auto; width: 100%; }

        /* â”€â”€ INPUT â”€â”€ */
        .bottom-shelf { position: absolute; bottom: 30px; left: 0; right: 0; padding: 0 20px; z-index: 50; }
        .input-box { 
            max-width: 800px; margin: 0 auto; display: flex; align-items: center; 
            background: white; border: 1.5px solid var(--slate-200); padding: 10px 16px; 
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        textarea { flex: 1; border: none; outline: none; resize: none; font-size: 16px; padding: 8px; max-height: 120px; }
        .btn-send { background: var(--primary); color: white; border: none; padding: 10px 22px; border-radius: 12px; cursor: pointer; font-weight: 700; }

        .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); z-index: 999; backdrop-filter: blur(4px); }
        @media (max-width: 768px) { .sidebar.active + .overlay { display: block; } }
    </style>
</head>
<body>

<div class="shell">
    <div class="overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar-toggle" onclick="toggleSidebar()">
        <div class="bar"></div><div class="bar" style="width: 14px;"></div><div class="bar"></div>
    </div>

    <aside class="sidebar" id="sidebar">
        <div class="brand"><span style="font-size: 22px;">ðŸ‡®ðŸ‡³</span><span>SchemeSahayak</span></div>
        <div class="btn-new-chat" onclick="clearCurrentChat()">+ New Conversation</div>
        
        <div style="flex:1; overflow-y:auto; padding: 10px 20px;">
            <p style="font-size:11px; color:var(--slate-500); font-weight:700; margin-bottom:15px; text-transform:uppercase;">Recent History</p>
            <div id="historyContainer"></div>
        </div>
    </aside>

    <main class="main">
        <div class="top-bar"><button class="btn-export" onclick="window.print()">Export to PDF</button></div>
        <div class="chat-container" id="chatContainer">
            <div class="center-wrap">
                <div id="welcome" class="welcome-hero" style="text-align: center; padding: 40px 0;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Ashoka_Chakra.svg" style="width:60px; opacity:0.4; margin-bottom:20px;">
                    <h1>Namaste ðŸ‡®ðŸ‡³</h1>
                    <p style="color:var(--slate-500);">Your history is now saved automatically.</p>
                </div>
                <div id="chatThread"></div>
            </div>
        </div>
        <div class="bottom-shelf">
            <div class="input-box">
                <textarea id="userInput" rows="1" placeholder="Ask about a scheme..."></textarea>
                <button class="btn-send" onclick="handleSend()">Send</button>
            </div>
        </div>
    </main>
</div>

<script>
    const input = document.getElementById('userInput');
    const chatContainer = document.getElementById('chatContainer');
    const chatThread = document.getElementById('chatThread');
    const historyContainer = document.getElementById('historyContainer');

    // â”€â”€ PERSISTENCE LOGIC â”€â”€
    let currentChat = JSON.parse(localStorage.getItem('currentChat')) || [];

    window.onload = () => {
        renderHistory();
        if (currentChat.length > 0) {
            document.getElementById('welcome').style.display = 'none';
            currentChat.forEach(msg => displayMessage(msg.text, msg.role, false));
        }
    };

    function toggleSidebar() {
        const sb = document.getElementById('sidebar');
        window.innerWidth <= 768 ? sb.classList.toggle('active') : sb.classList.toggle('collapsed');
    }

    function saveChat() {
        localStorage.setItem('currentChat', JSON.stringify(currentChat));
        updateHistorySidebar();
    }

    function clearCurrentChat() {
        if(currentChat.length > 0) {
            let allHistory = JSON.parse(localStorage.getItem('allHistory')) || [];
            allHistory.unshift({ title: currentChat[0].text, data: currentChat });
            localStorage.setItem('allHistory', JSON.stringify(allHistory.slice(0, 10))); // Keep last 10
        }
        localStorage.removeItem('currentChat');
        location.reload();
    }

    function updateHistorySidebar() {
        renderHistory();
    }

    function renderHistory() {
        const allHistory = JSON.parse(localStorage.getItem('allHistory')) || [];
        historyContainer.innerHTML = allHistory.length ? '' : '<div style="font-size:12px; color:#555;">No history yet</div>';
        allHistory.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerText = item.title;
            div.onclick = () => loadHistoryItem(index);
            historyContainer.appendChild(div);
        });
    }

    function loadHistoryItem(index) {
        const allHistory = JSON.parse(localStorage.getItem('allHistory')) || [];
        currentChat = allHistory[index].data;
        localStorage.setItem('currentChat', JSON.stringify(currentChat));
        location.reload();
    }

    function displayMessage(text, role, save = true) {
        document.getElementById('welcome').style.display = 'none';
        const row = document.createElement('div');
        row.style.marginBottom = '20px';
        row.style.display = 'flex';
        row.style.flexDirection = 'column';
        row.style.alignItems = role === 'user' ? 'flex-end' : 'flex-start';
        
        row.innerHTML = `
            <div style="font-size:10px; font-weight:800; color:var(--slate-500); margin-bottom:5px;">${role.toUpperCase()}</div>
            <div style="background:${role === 'user' ? 'var(--slate-800)' : 'white'}; color:${role === 'user' ? 'white' : 'inherit'}; padding:15px; border-radius:15px; max-width:85%; border:${role === 'bot' ? '1px solid var(--slate-200)' : 'none'}; line-height:1.6;">${text}</div>
        `;
        chatThread.appendChild(row);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        if (save) {
            currentChat.push({ text, role });
            saveChat();
        }
    }

    async function handleSend() {
        const val = input.value.trim();
        if(!val) return;
        displayMessage(val, 'user');
        input.value = '';
        
        // Mock API Call - Replace with your FastAPI call
        setTimeout(() => {
            displayMessage("I have saved this conversation to your local history. How else can I help?", 'bot');
        }, 600);
    }
</script>
</body>
</html>