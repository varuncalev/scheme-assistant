<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SchemeSahayak â€” Official Government AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg-side: #0f172a;
            --primary: #4f46e5;
            --slate-200: #e2e8f0;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-800: #1e293b;
            --saffron: #FF9933;
            --sidebar-w: 272px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            height: 100vh; width: 100%; overflow: hidden;
            color: var(--slate-800);
            background: linear-gradient(180deg,
                rgba(255,153,51,0.13) 0%,
                #ffffff 45%,
                rgba(19,136,8,0.13) 100%) fixed;
        }

        /* â”€â”€ SHELL â”€â”€ */
        .shell { display: flex; height: 100vh; width: 100%; overflow: hidden; position: relative; }

        /* â”€â”€ SIDEBAR â”€â”€ */
        .sidebar {
            width: 0;
            overflow: hidden;
            background: var(--bg-side);
            color: white;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: width 0.32s cubic-bezier(0.4,0,0.2,1);
            box-shadow: none;
            z-index: 200;
        }
        .sidebar.open {
            width: var(--sidebar-w);
            box-shadow: 4px 0 24px rgba(0,0,0,0.25);
        }

        /* Inner sidebar content â€” fixed width so it doesn't squish during transition */
        .sidebar-inner {
            width: var(--sidebar-w);
            min-width: var(--sidebar-w);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* â”€â”€ BRAND ROW â”€â”€ */
        .brand {
            display: flex; align-items: center; gap: 12px;
            padding: 18px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            flex-shrink: 0;
        }
        .brand-text { font-weight: 800; font-size: 19px; letter-spacing: -0.4px; flex: 1; white-space: nowrap; }

        /* Hamburger inside sidebar (to close it) */
        .ham-btn {
            width: 36px; height: 36px; flex-shrink: 0;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: 9px; cursor: pointer;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 4px;
            transition: background 0.2s;
        }
        .ham-btn:hover { background: rgba(255,255,255,0.18); }
        .ham-btn .b { background: rgba(255,255,255,0.82); border-radius: 2px; height: 2px; }
        .ham-btn .b1 { width: 16px; }
        .ham-btn .b2 { width: 11px; align-self: flex-start; margin-left: 10px; }
        .ham-btn .b3 { width: 16px; }

        .btn-new-chat {
            margin: 14px 14px 0;
            padding: 11px 14px; border-radius: 11px;
            background: rgba(255,153,51,0.1);
            color: var(--saffron); border: 1px solid rgba(255,153,51,0.3);
            text-align: center; cursor: pointer; font-weight: 700; font-size: 13px;
            transition: background 0.2s; flex-shrink: 0; white-space: nowrap;
        }
        .btn-new-chat:hover { background: rgba(255,153,51,0.2); }

        .sidebar-scroll { flex: 1; overflow-y: auto; padding: 0 12px 16px; scrollbar-width: thin; }
        .section-title {
            font-size: 10px; color: var(--slate-500); margin: 22px 0 10px 10px;
            font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; white-space: nowrap;
        }
        .nav-item {
            font-size: 13px; color: var(--slate-400); padding: 10px 12px; border-radius: 9px;
            cursor: pointer; display: flex; align-items: center; gap: 10px;
            transition: 0.2s; margin-bottom: 3px; white-space: nowrap;
        }
        .nav-item:hover { background: rgba(255,255,255,0.08); color: white; }

        .history-item {
            font-size: 12px; color: var(--slate-400); padding: 8px 12px; border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; gap: 7px;
            transition: 0.2s; margin-bottom: 2px;
            overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
        }
        .history-item:hover { background: rgba(255,255,255,0.08); color: white; }
        .no-history { font-size: 11px; color: var(--slate-500); padding: 8px 12px; font-style: italic; }

        /* â”€â”€ MAIN â”€â”€ */
        .main { flex: 1; display: flex; flex-direction: column; min-width: 0; position: relative; }

        /* â”€â”€ TOPBAR â€” fully transparent â”€â”€ */
        .top-bar {
            height: 62px; flex-shrink: 0;
            display: flex; align-items: center;
            justify-content: space-between;
            padding: 0 20px 0 18px;
            background: transparent;
        }

        /* Top-bar hamburger (open sidebar) â€” always rendered, visibility toggled via JS */
        .top-ham {
            width: 40px; height: 40px; flex-shrink: 0;
            background: rgba(255,255,255,0.85);
            border: 1px solid var(--slate-200);
            border-radius: 10px; cursor: pointer;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 4px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            backdrop-filter: blur(8px);
            transition: transform 0.15s, box-shadow 0.2s;
        }
        .top-ham:hover { transform: translateY(-1px); box-shadow: 0 5px 14px rgba(0,0,0,0.12); }
        .top-ham .b { background: var(--slate-800); border-radius: 2px; height: 2px; }
        .top-ham .b1 { width: 16px; }
        .top-ham .b2 { width: 11px; align-self: flex-start; margin-left: 12px; }
        .top-ham .b3 { width: 16px; }

        .export-btn {
            background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
            border: 1px solid var(--slate-200);
            padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600;
            cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: 0.2s;
            font-family: inherit;
        }
        .export-btn:hover { background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        /* â”€â”€ CHAT AREA â”€â”€ */
        .chat-container { flex: 1; overflow-y: auto; padding: 0 20px 170px; scroll-behavior: smooth; }
        .center-wrap { max-width: 820px; margin: 0 auto; width: 100%; }

        .welcome-hero { text-align: center; padding: 40px 0 20px; animation: fadeUp 0.7s ease-out; }
        .welcome-hero h1 { font-size: 36px; font-weight: 800; margin-bottom: 10px; letter-spacing: -1px; }

        /* Ashoka Chakra above Namaste */
        .chakra-wrap {
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 20px;
        }
        .chakra-img {
            width: 82px; height: 82px;
            filter: drop-shadow(0 0 18px rgba(19,136,8,0.35)) drop-shadow(0 0 6px rgba(255,153,51,0.3));
            animation: spin 18s linear infinite;
        }
        /* Flag emoji â€” rendered as actual emoji, not "IN" text */
        .flag-emoji {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
            font-size: 36px;
            vertical-align: middle;
            line-height: 1;
        }

        .sample-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; margin-top: 34px; }
        .sample-card {
            background: white; padding: 18px 20px; border-radius: 14px;
            border: 1px solid var(--slate-200); cursor: pointer; transition: 0.25s;
            text-align: left; box-shadow: 0 2px 6px rgba(0,0,0,0.03);
        }
        .sample-card:hover { border-color: var(--saffron); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.06); }
        .sample-card h4 { font-size: 14px; font-weight: 700; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .sample-card p { font-size: 12.5px; color: var(--slate-500); line-height: 1.45; }

        /* â”€â”€ MESSAGES â”€â”€ */
        .msg-row { display: flex; flex-direction: column; margin-bottom: 28px; animation: slideUp 0.35s ease-out; }
        .msg-row.user { align-items: flex-end; }
        .msg-label { font-size: 10px; font-weight: 800; color: var(--slate-400); margin-bottom: 5px; padding: 0 4px; }
        .bubble {
            background: white; padding: 18px 22px; border-radius: 18px;
            border: 1px solid var(--slate-200); max-width: 84%; line-height: 1.72;
            font-size: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .msg-row.user .bubble { background: var(--slate-800); color: white; border: none; border-bottom-right-radius: 4px; }
        .msg-row.bot  .bubble { border-bottom-left-radius: 4px; }

        .scheme-result {
            background: #fefefe; border: 1px solid var(--slate-200);
            border-left: 5px solid var(--saffron);
            padding: 16px; margin: 14px 0; border-radius: 10px;
        }
        .scheme-tag { font-size: 9px; font-weight: 800; color: var(--saffron); text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.8px; }
        .scheme-result h3 { font-size: 17px; margin-bottom: 6px; }
        .scheme-detail { font-size: 13px; color: var(--slate-500); margin-bottom: 10px; }
        .apply-btn {
            display: inline-flex; align-items: center; gap: 6px;
            background: var(--primary); color: white !important;
            padding: 9px 18px; border-radius: 9px; text-decoration: none;
            font-size: 13px; font-weight: 700; transition: 0.2s;
        }
        .apply-btn:hover { opacity: 0.9; }

        /* â”€â”€ INPUT â”€â”€ */
        .bottom-shelf { position: absolute; bottom: 28px; left: 0; right: 0; padding: 0 18px; z-index: 50; }
        .input-box {
            max-width: 820px; margin: 0 auto;
            display: flex; align-items: flex-end;
            background: white; border: 1px solid var(--slate-200);
            padding: 10px 14px; border-radius: 22px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.13);
        }
        textarea {
            flex: 1; border: none; outline: none; resize: none;
            font-size: 15px; font-family: inherit;
            padding: 9px 10px; max-height: 140px; background: transparent;
        }
        .btn-send {
            background: var(--primary); color: white; border: none;
            height: 42px; width: 42px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; flex-shrink: 0;
        }
        .btn-send:hover { transform: rotate(-15deg) scale(1.1); }

        /* â”€â”€ MOBILE OVERLAY â”€â”€ */
        .overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.42); z-index: 150;
            backdrop-filter: blur(4px);
        }
        .overlay.show { display: block; }

        @keyframes fadeUp  { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
        @keyframes slideUp { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
        @keyframes spin    { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* â”€â”€ MOBILE: sidebar overlays instead of pushing â”€â”€ */
        @media (max-width: 680px) {
            .sidebar {
                position: fixed; top: 0; left: 0; height: 100%;
                width: 0 !important;
                transition: width 0.32s cubic-bezier(0.4,0,0.2,1);
            }
            .sidebar.open { width: var(--sidebar-w) !important; }
        }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<div class="shell">
    <!-- â”€â”€ SIDEBAR â”€â”€ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-inner">
            <div class="brand">
                <div class="ham-btn" onclick="closeSidebar()" title="Close sidebar">
                    <div class="b b1"></div>
                    <div class="b b2"></div>
                    <div class="b b3"></div>
                </div>
                <span class="brand-text">ğŸ‡®ğŸ‡³ SchemeSahayak</span>
            </div>

            <div class="btn-new-chat" onclick="startNew()">+ Start New Conversation</div>

            <div class="sidebar-scroll">
                <p class="section-title">Explore Categories</p>
                <div class="nav-item" onclick="sidebarAsk('Farming & Agriculture schemes')">ğŸŒ¾ Agriculture</div>
                <div class="nav-item" onclick="sidebarAsk('Healthcare & Ayushman Bharat')">ğŸ¥ Healthcare</div>
                <div class="nav-item" onclick="sidebarAsk('Scholarships for students')">ğŸ“ Education</div>
                <div class="nav-item" onclick="sidebarAsk('Startup & Business Loans')">ğŸ’¼ Business</div>
                <div class="nav-item" onclick="sidebarAsk('Housing & PMAY schemes')">ğŸ  Housing</div>
                <div class="nav-item" onclick="sidebarAsk('Employment & MGNREGA')">ğŸ› ï¸ Employment</div>

                <p class="section-title">Recent Activity</p>
                <div id="historyList">
                    <div class="no-history" id="noHistMsg">No recent history</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- â”€â”€ MAIN â”€â”€ -->
    <main class="main">
        <div class="top-bar">
            <div class="top-ham" id="topHam" onclick="openSidebar()" title="Open sidebar">
                <div class="b b1"></div>
                <div class="b b2"></div>
                <div class="b b3"></div>
            </div>
            <button class="export-btn" onclick="exportPDF()">Export PDF</button>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="center-wrap">
                <div id="welcome" class="welcome-hero">
                    <div class="chakra-wrap">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Ashoka_Chakra.svg"
                             class="chakra-img" alt="Ashoka Chakra">
                    </div>
                    <h1>Namaste <span class="flag-emoji">ğŸ‡®ğŸ‡³</span></h1>
                    <p style="color:var(--slate-500); font-size:17px; margin-top:6px;">How can I help you find government benefits today?</p>

                    <div class="sample-grid">
                        <div class="sample-card" onclick="quickAsk('I am a farmer, what benefits can I get?')">
                            <h4>ğŸŒ¾ Agriculture Support</h4>
                            <p>Learn about PM-KISAN, KCC, and crop insurance subsidies.</p>
                        </div>
                        <div class="sample-card" onclick="quickAsk('Loans for small businesses and startups')">
                            <h4>ğŸ’¼ Business &amp; Growth</h4>
                            <p>Explore MUDRA loans, Stand Up India, and startup recognition.</p>
                        </div>
                        <div class="sample-card" onclick="quickAsk('Health insurance for poor families')">
                            <h4>ğŸ¥ Health &amp; Wellness</h4>
                            <p>Details on Ayushman Bharat (PM-JAY) and health cards.</p>
                        </div>
                        <div class="sample-card" onclick="quickAsk('Scholarships for higher education')">
                            <h4>ğŸ“ Student Empowerment</h4>
                            <p>Find National Scholarship Portal (NSP) and girl child schemes.</p>
                        </div>
                    </div>
                </div>

                <div id="chatThread"></div>
                <div id="typing" style="display:none; color:var(--slate-400); font-size:13px; padding:8px 0;">
                    Searching official 2026 databaseâ€¦
                </div>
            </div>
        </div>

        <div class="bottom-shelf">
            <div class="input-box">
                <textarea id="userInput" rows="1" placeholder="Describe your situation (e.g., 'I want to start a shop')"></textarea>
                <button class="btn-send" onclick="handleSend()">
                    <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
                    </svg>
                </button>
            </div>
        </div>
    </main>
</div>

<script>
    const sidebar  = document.getElementById('sidebar');
    const overlay  = document.getElementById('overlay');
    const topHam   = document.getElementById('topHam');
    const input    = document.getElementById('userInput');
    const chatCont = document.getElementById('chatContainer');

    /* â”€â”€ SIDEBAR OPEN / CLOSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function openSidebar() {
        sidebar.classList.add('open');
        topHam.style.visibility = 'hidden';          // hide the opener while sidebar is showing
        if (window.innerWidth <= 680) overlay.classList.add('show');
    }

    function closeSidebar() {
        sidebar.classList.remove('open');
        topHam.style.visibility = 'visible';
        overlay.classList.remove('show');
    }

    /* â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const HIST_KEY = 'ss_history_v1';
    let chatHistory = [];
    try { chatHistory = JSON.parse(localStorage.getItem(HIST_KEY) || '[]'); } catch(e) {}

    function saveHistory() {
        try { localStorage.setItem(HIST_KEY, JSON.stringify(chatHistory)); } catch(e) {}
    }

    function addToHistory(q) {
        chatHistory = chatHistory.filter(h => h !== q);
        chatHistory.unshift(q);
        if (chatHistory.length > 15) chatHistory = chatHistory.slice(0, 15);
        saveHistory();
        renderHistory();
    }

    function renderHistory() {
        const list  = document.getElementById('historyList');
        const noMsg = document.getElementById('noHistMsg');
        list.querySelectorAll('.history-item').forEach(el => el.remove());

        if (chatHistory.length === 0) { noMsg.style.display = ''; return; }
        noMsg.style.display = 'none';

        chatHistory.forEach(q => {
            const d = document.createElement('div');
            d.className = 'history-item';
            d.title = q;
            d.textContent = 'ğŸ’¬ ' + (q.length > 30 ? q.slice(0,30) + 'â€¦' : q);
            d.onclick = () => { closeSidebar(); quickAsk(q); };
            list.appendChild(d);
        });
    }
    renderHistory();

    /* â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    input.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
    input.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
    });

    function quickAsk(q) { input.value = q; handleSend(); }

    function sidebarAsk(q) { closeSidebar(); quickAsk(q); }

    function startNew() {
        document.getElementById('chatThread').innerHTML = '';
        document.getElementById('welcome').style.display = '';
        input.value = '';
        closeSidebar();
    }

    /* â”€â”€ SCHEME PARSER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const SCHEMES = [
        { key:'PM-KISAN',          url:'https://pmkisan.gov.in',                              desc:'â‚¹6,000 yearly income support for farmers.' },
        { key:'Ayushman Bharat',   url:'https://pmjay.gov.in',                                desc:'â‚¹5 Lakh free health cover for families.' },
        { key:'MUDRA Loan',        url:'https://www.mudra.org.in',                            desc:'Collateral-free loans up to â‚¹10 Lakh.' },
        { key:'Startup India',     url:'https://www.startupindia.gov.in',                     desc:'Tax benefits and funding for new ventures.' },
        { key:'Sukanya Samriddhi', url:'https://www.india.gov.in/sukanya-samriddhi-yojana',   desc:'Savings scheme for the girl child (8.2% interest).' },
    ];

    function parseBotResponse(text) {
        let fmt = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        SCHEMES.forEach(s => {
            fmt = fmt.replace(new RegExp(s.key,'g'), `
                <div class="scheme-result">
                    <div class="scheme-tag">Official Government Scheme</div>
                    <h3>${s.key}</h3>
                    <div class="scheme-detail">${s.desc}</div>
                    <a href="${s.url}" class="apply-btn" target="_blank">Apply Now â†—</a>
                </div>`);
        });
        return fmt.replace(/\n/g,'<br>');
    }

    /* â”€â”€ MESSAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function addMessage(text, role) {
        document.getElementById('welcome').style.display = 'none';
        const row = document.createElement('div');
        row.className = 'msg-row ' + role;
        row.innerHTML = `
            <div class="msg-label">${role === 'user' ? 'YOU' : 'SCHEMESAHAYAK ğŸ‡®ğŸ‡³'}</div>
            <div class="bubble">${role === 'bot' ? parseBotResponse(text) : text}</div>`;
        document.getElementById('chatThread').appendChild(row);
        chatCont.scrollTop = chatCont.scrollHeight;
    }

    /* â”€â”€ SEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function handleSend() {
        const val = input.value.trim();
        if (!val) return;
        addMessage(val, 'user');
        addToHistory(val);
        input.value = ''; input.style.height = 'auto';
        document.getElementById('typing').style.display = 'block';

        try {
            const res  = await fetch('/chat', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ message: val })
            });
            const data = await res.json();
            document.getElementById('typing').style.display = 'none';
            addMessage(data.response, 'bot');
        } catch {
            document.getElementById('typing').style.display = 'none';
            addMessage('Namaste. I am having trouble reaching the official database right now. Please check your connection or try again.', 'bot');
        }
    }

    function exportPDF() { window.print(); }
</script>
</body>
</html>